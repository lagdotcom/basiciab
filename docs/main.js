(()=>{var e={424:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(537),s=r.n(n),a=r(645),i=r.n(a)()(s());i.push([e.id,"body {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tpadding: 0;\r\n\tmargin: 0;\r\n\theight: 100vh;\r\n}\r\n\r\n.basiciab-upload {\r\n\tflex: 1 0 20px;\r\n}\r\n\r\n#basiciab {\r\n\tflex: 0 1 100vh;\r\n\timage-rendering: crisp-edges;\r\n\timage-rendering: pixelated;\r\n}\r\n","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;CACC,aAAa;CACb,sBAAsB;CACtB,UAAU;CACV,SAAS;CACT,aAAa;AACd;;AAEA;CACC,cAAc;AACf;;AAEA;CACC,eAAe;CACf,4BAA4B;CAC5B,0BAA0B;AAC3B",sourcesContent:["body {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tpadding: 0;\r\n\tmargin: 0;\r\n\theight: 100vh;\r\n}\r\n\r\n.basiciab-upload {\r\n\tflex: 1 0 20px;\r\n}\r\n\r\n#basiciab {\r\n\tflex: 0 1 100vh;\r\n\timage-rendering: crisp-edges;\r\n\timage-rendering: pixelated;\r\n}\r\n"],sourceRoot:""}]);const o=i},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(i[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);n&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),t.push(c))}},t}},537:e=>{"use strict";e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),a="/*# ".concat(s," */");return[t].concat([a]).join("\n")}return[t].join("\n")}},714:function(e,t){var r,n;void 0===(n="function"==typeof(r=function(){var e=document,t=e.createElement("span"),r=e.createElement("span");function n(){e.body.removeChild(t),e.body.removeChild(r)}return t.s=t.style,r.s=r.style,function(s){function a(){return t.offsetWidth!==r.offsetWidth||t.offsetHeight!==r.offsetHeight}return""!==s&&void 0!==s&&(function(n){var s,a="HeRe-is*SoMe%tEst +99.? !@ #~ &^teXtWw L$VEY$U0",i={fontSize:"64px",margin:"0",padding:"0",position:"absolute",top:"-161616px",left:"-161616px"};for(s in i)t.s[s]=i[s],r.s[s]=i[s];t.s.fontFamily=n+", monospace",r.s.fontFamily="monospace",t.innerHTML=a,r.innerHTML=a,e.body.appendChild(t),e.body.appendChild(r)}(s=s.replace(/[\,\.\/\<\>\!\?\;\'\"\[\]\\\{\}\|\=\*\(\)\$\%\^\&]/g,"")),a()?(n(),!0):(t.s.fontFamily=s+", sans-serif",r.s.fontFamily="sans-serif",a()?(n(),!0):(n(),!1)))}})?r.apply(t,[]):r)||(e.exports=n)},379:e=>{"use strict";var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var a={},i=[],o=0;o<e.length;o++){var l=e[o],u=n.base?l[0]+n.base:l[0],c=a[u]||0,h="".concat(u," ").concat(c);a[u]=c+1;var f=r(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var d=s(p,n);n.byIndex=o,t.splice(o,0,{identifier:h,updater:d,references:1})}i.push(h)}return i}function s(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,s){var a=n(e=e||[],s=s||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var o=r(a[i]);t[o].references--}for(var l=n(e,s),u=0;u<a.length;u++){var c=r(a[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=l}}},569:e=>{"use strict";var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var s=void 0!==r.layer;s&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,s&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var a=r.sourceMap;a&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={id:n,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nc=void 0,(()=>{"use strict";var e={};r.r(e),r.d(e,{Pos:()=>I});var t={};r.r(t),r.d(t,{Abs:()=>T,Atn:()=>O,Cos:()=>R,Exp:()=>F,Int:()=>D,Log:()=>M,Rnd:()=>P,Sgn:()=>U,Sin:()=>H,Sqr:()=>_,Tan:()=>W});var n={};r.r(n),r.d(n,{Asc:()=>j,Chr:()=>B,Left:()=>z,Len:()=>G,Mid:()=>X,Right:()=>q,Str:()=>V,Val:()=>Z});var s=r(379),a=r.n(s),i=r(795),o=r.n(i),l=r(569),u=r.n(l),c=r(565),h=r.n(c),f=r(216),p=r.n(f),d=r(589),m=r.n(d),v=r(424),g={};g.styleTagTransform=m(),g.setAttributes=h(),g.insert=u().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=p(),a()(v.Z,g),v.Z&&v.Z.locals&&v.Z.locals;const w=["#000000","#0000aa","#00aa00","#00aaaa","#aa0000","#aa00aa","#aaaa00","#aaaaaa","#000055","#0000ff","#00aa55","#00aaff","#aa0055","#aa00ff","#aaaa55","#aaaaff","#005500","#0055aa","#00ff00","#00ffaa","#aa5500","#aa55aa","#aaff00","#aaffaa","#005555","#0055ff","#00ff55","#00ffff","#aa5555","#aa55ff","#aaff55","#aaffff","#550000","#5500aa","#55aa00","#55aaaa","#ff0000","#ff00aa","#ffaa00","#ffaaaa","#550055","#5500ff","#55aa55","#55aaff","#ff0055","#ff00ff","#ffaa55","#ffaaff","#555500","#5555aa","#55ff00","#55ffaa","#ff5500","#ff55aa","#ffff00","#ffffaa","#555555","#5555ff","#55ff55","#55ffff","#ff5555","#ff55ff","#ffff55","#ffffff"],y=w;window.Palette=w;var E=r(714),b=r.n(E);class x{outerCanvas;tileWidth;tileHeight;fontSize;defaultRows;defaultCols;bg;border;cols;cx;cy;fg;font;inner;innerCanvas;outer;needsResize;rows;constructor(e,t=8,r=8,n=8,s=40,a=50){this.outerCanvas=e,this.tileWidth=t,this.tileHeight=r,this.fontSize=n,this.defaultRows=s,this.defaultCols=a;const i=e.getContext("2d");if(!i)throw new Error("Could not get outer canvas context");this.outer=i,i.imageSmoothingEnabled=!1;const o=()=>{const{clientWidth:t,clientHeight:r}=e;e.width=t,e.height=r};window.addEventListener("resize",o),o()}get pos(){return this.cx.value}attach(e){const t=(e,t)=>{e.value=t,this.needsResize=!0};this.rows=e.vars.add("__rows",{value:this.defaultRows,system:!0,set:t}),this.cols=e.vars.add("__cols",{value:this.defaultCols,system:!0,set:t}),e.vars.add("__width",{value:0,system:!0,get:()=>this.cols.value*this.tileWidth}),e.vars.add("__height",{value:0,system:!0,get:()=>this.rows.value*this.tileHeight}),this.font=e.vars.add("__font$",{value:this.getBestFont(),system:!0,set:t}),this.fg=e.vars.add("__fg",{value:7,system:!0}),this.bg=e.vars.add("__bg",{value:0,system:!0}),this.border=e.vars.add("__border",{value:56,system:!0}),this.cx=e.vars.add("__cx",{value:0,system:!0}),this.cy=e.vars.add("__cy",{value:0,system:!0}),this.resize()}getBestFont(){const e=`${this.fontSize}px `,t=["Iosevka Term","Lucida Console","Consolas","Courier New"];for(var r=0;r<t.length;r++)if(b()(t[r]))return e+t[r];return e+"monospace"}cls(){this.resize()}resize(){const e=this.cols.value*this.tileWidth,t=this.rows.value*this.tileHeight,r=document.createElement("canvas");r.width=e,r.height=t;const n=r.getContext("2d");if(!n)throw new Error("Could not get inner canvas context");n.textAlign="center",n.textBaseline="middle",n.font=this.font.value,n.fillStyle=y[this.bg.value],n.fillRect(0,0,e,t),n.imageSmoothingEnabled=!1,this.cx.value=0,this.cy.value=0,this.inner=n,this.innerCanvas=r,this.needsResize=!1}update(){this.needsResize&&this.resize();const{outer:e,innerCanvas:t,border:r,outerCanvas:n}=this,{width:s,height:a}=n;e.fillStyle=y[r.value],e.fillRect(0,0,s,a);const i=t.width,o=t.height,l=Math.floor(s/i),u=Math.floor(a/o),c=Math.max(1,Math.min(l,u)),h=i*c,f=o*c,p=Math.floor((s-h)/2),d=Math.floor((a-f)/2);e.drawImage(t,p,d,h,f)}writenl(e){this.write(e),0!=this.cx.value&&this.nl()}write(e){const{fg:t,bg:r,cols:n,cx:s,cy:a,inner:i,tileWidth:o,tileHeight:l}=this;for(var u=0;u<e.length;u++){const c=e[u],h=s.value*o,f=a.value*l;i.fillStyle=y[r.value],i.fillRect(h,f,o,l),i.fillStyle=y[t.value],i.fillText(c,h+o/2,f+l/2),s.value++,s.value>=n.value&&this.nl()}}nl(){const{cx:e,cy:t,rows:r}=this;if(e.value=0,t.value++,t.value>=r.value){t.value=r.value-1;const{bg:e,inner:n,innerCanvas:s,tileHeight:a}=this,i=0,o=a,l=s.width,u=s.height-o,c=0,h=0,f=l,p=u;n.drawImage(s,i,o,l,u,c,h,f,p),n.fillStyle=y[e.value],n.fillRect(0,u,l,a)}}bs(){const{cx:e}=this;e.value>0&&(e.value--,this.write(" "),e.value--)}line(e,t,r,n){this.inner.strokeStyle=y[this.fg.value],this.inner.moveTo(e,t),this.inner.lineTo(r,n),this.inner.stroke()}}const C=["Alt","AltGraph","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","CapsLock","Clear","ContextMenu","Control","Delete","End","Enter","Home","Insert","NumLock","PageDown","PageUp","Pause","Shift"];class k{events;constructor(){document.addEventListener("keydown",this.keypress.bind(this)),this.events=[]}keypress(e){const t=e.key;"Backspace"===t?this.events.push({type:"back",key:t}):"Pause"===t?this.events.push({type:"break",key:t}):C.includes(t)?this.events.push({type:"meta",key:t}):this.events.push({type:"key",key:t}),e.preventDefault()}}class S{vars;constructor(){this.vars={}}clear(){for(var e in this.vars)this.vars[e].system||delete this.vars[e]}has(e){return!!this.vars[e.toLowerCase()]}add(e,t){return this.vars[e]=t,t}constant(e,t){return this.vars[e]={value:t,system:!0,get:()=>t,set(){throw new Error(`${e} is constant`)}},this.vars[e]}get(e){const t=this.vars[e.toLowerCase()];if(!t)throw new Error(`Undefined var: ${e}`);return t.get?t.get(t):t.value}set(e,t){const r=this.vars[e.toLowerCase()];if(!r)throw new Error(`Undefined var: ${e}`);r.set?r.set(r,t):r.value=t}}function A(e){return e?-1:0}function L(e){return"number"==typeof e}function $(e){return"string"==typeof e}function N(e){return void 0===e}const I={name:"pos",evaluate(e,t){if(0!==t.length)throw new Error("POS takes no arguments");return e.display.pos}},T={name:"abs",evaluate(e,t){if(1!==t.length)throw new Error("ABS takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("ABS only uses numbers");return Math.abs(r)}},O={name:"atn",evaluate(e,t){if(1!==t.length)throw new Error("ATN takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("ATN only uses numbers");return Math.atan(r)}},R={name:"cos",evaluate(e,t){if(1!==t.length)throw new Error("COS takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("COS only uses numbers");return Math.cos(r)}},F={name:"exp",evaluate(e,t){if(1!==t.length)throw new Error("EXP takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("EXP only uses numbers");return Math.exp(r)}},D={name:"int",evaluate(e,t){if(1!==t.length)throw new Error("INT takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("INT only uses numbers");return Math.floor(r)}},M={name:"log",evaluate(e,t){if(1!==t.length)throw new Error("LOG takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("LOG only uses numbers");return Math.log(r)}},P={name:"rnd",evaluate(e,t){let r=1;switch(t.length){case 0:break;case 1:const n=e.evaluate(t[0]);if(!L(n))throw new Error("RND only uses numbers");r=n;break;default:throw new Error("RND takes one or no arguments")}return Math.random()*r}},U={name:"sgn",evaluate(e,t){if(1!==t.length)throw new Error("SGN takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("SGN only uses numbers");return 0==r?0:r<0?-1:1}},H={name:"sin",evaluate(e,t){if(1!==t.length)throw new Error("SIN takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("SIN only uses numbers");return Math.sin(r)}},_={name:"sqr",evaluate(e,t){if(1!==t.length)throw new Error("SQR takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("SQR only uses numbers");return Math.sqrt(r)}},W={name:"tan",evaluate(e,t){if(1!==t.length)throw new Error("TAN takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("TAN only uses numbers");return Math.tan(r)}},j={name:"asc",evaluate(e,t){if(1!==t.length)throw new Error("ASC takes 1 argument");const r=e.evaluate(t[0]);if(!$(r))throw new Error("ASC only uses strings");return r.charCodeAt(0)}},B={name:"chr$",evaluate(e,t){if(1!==t.length)throw new Error("CHR$ takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("CHR$ only uses numbers");return String.fromCharCode(r)}},z={name:"left$",evaluate(e,t){if(2!==t.length)throw new Error("LEFT$ takes 2 arguments");const r=e.evaluate(t[0]),n=e.evaluate(t[1]);if(!$(r)||!L(n))throw new Error("syntax: LEFT$(string, number)");return r.substr(0,n)}},G={name:"len",evaluate(e,t){if(1!==t.length)throw new Error("LEN takes 1 argument");const r=e.evaluate(t[0]);if(!$(r))throw new Error("LEN only uses strings");return r.length}},X={name:"mid$",evaluate(e,t){if(t.length<2||t.length>3)throw new Error("MID$ takes 2-3 arguments");const r=e.evaluate(t[0]),n=e.evaluate(t[1]);if(!$(r)||!L(n))throw new Error("syntax: MID$(string, number[, number])");const s=3===t.length?e.evaluate(t[2]):r.length;if(!L(s))throw new Error("syntax: MID$(string, number[, number])");return r.substr(n,s)}},q={name:"right$",evaluate(e,t){if(2!==t.length)throw new Error("RIGHT$ takes 2 arguments");const r=e.evaluate(t[0]),n=e.evaluate(t[1]);if(!$(r)||!L(n))throw new Error("syntax: RIGHT$(string, number)");return r.substr(r.length-n)}},V={name:"str$",evaluate(e,t){if(1!==t.length)throw new Error("STR$ takes 1 argument");const r=e.evaluate(t[0]);if(!L(r))throw new Error("STR$ only uses numbers");return r.toString()}},Z={name:"val",evaluate(e,t){if(1!==t.length)throw new Error("VAL takes 1 argument");const r=e.evaluate(t[0]);if(!$(r))throw new Error("VAL only uses strings");const n=parseInt(r,10);return isNaN(n)?0:n}},J=Object.fromEntries([...Object.values(e),...Object.values(n),...Object.values(t)].map((e=>[e.name.toUpperCase(),e]))),K=/^[a-zA-Z_][a-zA-Z0-9_]*\$?$/;function Q(e){return K.test(e)}const Y=/^\d+(\.\d+)?$/;class ee{value;pos;saved;constructor(e,t=0,r=0){this.value=e,this.pos=t,this.saved=r}get atEnd(){return this.pos>=this.value.length}get remainder(){return this.value.substr(this.pos)}get peek(){return this.value.substr(this.pos,1)}save(){this.saved=this.pos}restore(){this.pos=this.saved}eatSpaces(){for(;-1!==" \t\n\r".indexOf(this.value[this.pos]);)this.pos++}nextWord(){this.eatSpaces();for(var e=null,t="";;){const r=this.value[this.pos];if(this.pos++,-1!==" \t\n\r".indexOf(r))return t;if(e){if(!e.test(t+r))return this.pos--,t;t+=r}else if(t=r,-1!=="1234567890".indexOf(r))e=Y;else{if(!Q(r))return t;e=K}if(this.atEnd)return t}}tryNumber(){const e=this.pos,t=this.nextWord();if(t){const e=parseInt(t,10);if(!isNaN(e))return this.log("found number:",e),e}this.pos=e}tryString(){if(this.eatSpaces(),'"'===this.value[this.pos]){const t=this.pos;var e="";for(this.pos++;'"'!==this.value[this.pos];)if(e+=this.value[this.pos],this.pos++,this.atEnd)return void(this.pos=t);return this.pos++,e}}trySeparator(){if(this.eatSpaces(),":"===this.value[this.pos])return this.pos++,":"}tryLiteral(e){const t=this.pos,r=this.nextWord();if(r.toLowerCase()===e.toLowerCase())return this.log("found literal:",r),r;this.pos=t}tryVariable(){const e=this.pos,t=this.nextWord();if(Q(t))return t;this.pos=e}tryExpression(e){const t=e?e.toLowerCase():e,r=this.pos;var n;const s=[],a=[],i=()=>{if(n){const e=a.pop(),t=a.pop();return this.log("bin:",t,n,e),t&&e?(a.push({type:"binary",op:n,args:[t,e]}),n=void 0,!0):(a.splice(0,a.length),!1)}return!0};for(;!this.atEnd;){const e=this.tryNumber();if(L(e)){if(a.push({type:"number",value:e}),this.log("num:",e),!i())break;continue}const r=this.tryString();if($(r)){if(a.push({type:"string",value:r}),this.log("str:",r),!i())break;continue}const o=this.pos,l=this.nextWord();if(":"===l){this.pos=o;break}if(t===l.toLowerCase()){this.pos=o;break}switch(l){case"+":case"-":case"*":case"/":case"<":n=l;continue;case">":if(void 0===n){n=">";continue}if("<"===n){n="<>";continue}break;case"=":if(void 0===n){n="=";continue}if("<"===n){n="<=";continue}if(">"===n){n=">=";continue}break;case"!":if("="===this.peek){n="!=",this.pos++;continue}break;case"(":const e=a.pop();if(e&&"variable"===e.type){s.push(e.name);continue}break;case")":const t=s.pop();if(t){const e={type:"fn",name:t,args:a.slice(0)};this.log("fn:",e),a.splice(0,a.length,e);continue}}if(!Q(l))break;if(a.push({type:"variable",name:l}),!i())break}if(1===a.length)return this.log("expr:",a[0]),a[0];this.log("failed, tokens=",a),this.pos=r}log(...e){}}function te(e,t){e.log("trying keyword:",t.name);const r=[];for(var n=0;n<t.expression.length;n++){if(e.atEnd)return;const a=t.expression[n];switch(a.type){case"expr":const i=t.expression[n+1];var s=void 0;i&&"literal"===i.type&&(s=i.value);const o=e.tryExpression(s);if(!o)return;r.push(o);continue;case"literal":if(!e.tryLiteral(a.value))return;continue;case"var":const l=e.tryVariable();if(!l)return;r.push({type:"variable",name:l});continue;case"number":const u=e.tryNumber();if(!L(u))return;r.push({type:"number",value:u});continue}throw new Error(`Invalid pattern type: ${a}`)}return{label:null,keyword:t.name,args:r}}function re(e){for(var t in e.save(),He){const r=te(e,He[t]);if(r)return r;e.restore()}}function ne(e){const t=new ee(e),r=t.tryNumber(),n=[];for(var s=t.pos;!t.atEnd;){if(n.length&&!t.trySeparator())throw new Error(`Could not parse: ${t.remainder}`);const e=re(t);if(!e)throw new Error(`Could not parse: ${t.remainder}`);if(n.push(e),t.pos===s)throw new Error("Parsing halted");s=t.pos}return r?{label:r,statements:n}:n[0]}function se(e){return e.split(" ").map((e=>"{var}"==e?{type:"var"}:"{expr}"==e?{type:"expr"}:"{number}"==e?{type:"number"}:{type:"literal",value:e}))}const ae={"=":1,"<>":1,"!=":1,">":1,"<":1,">=":1,"<=":1,"+":10,"-":10,"*":20,"/":20};function ie(e,t=0){switch(e.type){case"variable":return e.name;case"number":return e.value.toString();case"string":return`"${e.value}"`;case"binary":const[r,n]=e.args,s=ae[e.op],a=`${ie(r,s)} ${e.op} ${ie(n,s)}`;return s<t?`(${a})`:a;case"fn":return`${e.name.toUpperCase()}(${e.args.map(ie).join(", ")})`}}function oe(e){const t=He[e.keyword];if(!t)throw new Error(`Unknown keyword: ${e.keyword}`);return t.render(e)}function le(e){return`${e.label} ${e.statements.map(oe).join(" : ")}`}const ue={name:"download",visible:"DOWNLOAD",expression:se("DOWNLOAD"),execute(e){if(e.state!==_e.Interpret)throw new Error("UPLOAD not in programs");if(!e.program.lines.length)throw new Error("Program is empty");const t=e.program.lines.map(le).join("\n"),r=new Blob([t],{type:"text/x-basic"}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=e.program.name,n.click()},render:()=>"DOWNLOAD"},ce={name:"upload",visible:"UPLOAD",expression:se("UPLOAD"),execute(e){if(e.state!==_e.Interpret)throw new Error("UPLOAD not in programs");document.querySelectorAll(".basiciab-upload").forEach((e=>{e.remove()}));const t=document.createElement("input");t.className="basiciab-upload",t.type="file",t.addEventListener("change",(()=>{if(!t||!t.files)return;const r=t.files[0],n=new FileReader;n.addEventListener("load",(s=>{e.display.write(`Received ${s.loaded} bytes... `),e.program={name:r.name,lines:[]},n.result.split(/[\n\r]/).forEach((r=>{t.remove();const n=r.trim();if(!n)return;const s=ne(n);null===s.label?e.runStatement(s):e.add(s)})),e.display.writenl(`${r.name} ready`)})),n.readAsText(r)})),t.click(),document.body.prepend(t)},render:()=>"UPLOAD"},he={name:"if",visible:"IF",expression:se("IF {expr}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("IF only in programs");const r=t.args[0];if(!e.evaluate(r)){const t=e.scan(["if"],["else","endif"]);if(!t)throw new Error("IF without ELSE/ENDIF");e.line=t,e.statement=0}},render:e=>`IF ${ie(e.args[0])}`},fe={name:"else",visible:"ELSE",expression:se("ELSE"),execute(e){if(e.state!==_e.Execute)throw new Error("ELSE only in programs");const t=e.scan(["if"],["endif"],1);if(!t)throw new Error("ELSE without ENDIF");e.line=t,e.statement=0},render:()=>"ELSE"},pe={name:"endif",visible:"ENDIF",expression:se("ENDIF"),execute(e){if(e.state!==_e.Execute)throw new Error("ENDIF only in programs")},render:()=>"ENDIF"},de={name:"if-then-goto",expression:se("IF {expr} THEN {number}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("IF only in programs");const[r,n]=t.args;e.evaluate(r)&&(e.line=n.value,e.statement=-1)},render(e){const[t,r]=e.args;return`IF ${ie(t)} THEN ${ie(r)}`}},me={name:"if-then-else-goto",expression:se("IF {expr} THEN {number} ELSE {number}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("IF only in programs");const[r,n,s]=t.args;e.line=e.evaluate(r)?n.value:s.value,e.statement=-1},render(e){const[t,r,n]=e.args;return`IF ${ie(t)} THEN ${ie(r)} ELSE ${ie(n)}`}};function ve(e,t,r,n,s){e.vars.has(t)?e.vars.set(t,r):e.vars.add(t,{value:r}),e.stack.push({type:"for",v:t,end:n,step:s,line:e.line,statement:e.statement})}const ge={name:"for",visible:"FOR",expression:se("FOR {var} = {expr} TO {expr}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("FOR only in programs");const[r,n,s]=t.args,a=e.evaluate(n),i=e.evaluate(s);if(!L(a)||!L(i))throw new Error("FOR only uses numbers");ve(e,r.name,a,i,1)},render(e){const[t,r,n]=e.args;return`FOR ${ie(t)} = ${ie(r)} TO ${ie(n)}`}},we={name:"for-step",expression:se("FOR {var} = {expr} TO {expr} STEP {expr}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("FOR only in programs");const[r,n,s,a]=t.args,i=e.evaluate(n),o=e.evaluate(s),l=e.evaluate(a);if(!L(i)||!L(o)||!L(l))throw new Error("FOR only uses numbers");ve(e,r.name,i,o,l)},render(e){const[t,r,n,s]=e.args;return`FOR ${ie(t)} = ${ie(r)} TO ${ie(n)} STEP ${ie(s)}`}};function ye(e,t){var r=e.vars.get(t.v);r+=t.step,t.step>0&&r>t.end||t.step<0&&r<t.end?e.stack.pop():(e.line=t.line,e.statement=t.statement),e.vars.set(t.v,r)}const Ee={name:"next",visible:"NEXT",expression:se("NEXT {var}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("NEXT only in programs");const[r]=t.args,n=e.topclause;if(!n||"for"!==n.type)throw new Error("NEXT without FOR");if(n.v!==r.name)throw new Error("Mismatched NEXT");return ye(e,n)},render(e){const[t]=e.args;return`NEXT ${ie(t)}`}},be={name:"next-implicit",expression:se("NEXT"),execute(e){if(e.state!==_e.Execute)throw new Error("FOR only in programs");const t=e.topclause;if(!t||"for"!==t.type)throw new Error("NEXT without FOR");return ye(e,t)},render:()=>"NEXT"};function xe(e,t){const[r,n]=t.args,s=e.evaluate(n);if("$"===r.name.substr(-1)){if(!$(s))throw new Error("Cannot store number in string variable")}else if(!L(s))throw new Error("Cannot store string in number variable");e.vars.has(r.name)?e.vars.set(r.name,s):e.vars.add(r.name,{value:s})}const Ce={name:"let",visible:"LET",expression:se("LET {var} = {expr}"),execute:xe,render(e){const[t,r]=e.args;return`LET ${ie(t)} = ${ie(r)}`}},ke={name:"let-implicit",expression:se("{var} = {expr}"),execute:xe,render(e){const[t,r]=e.args;return`${ie(t)} = ${ie(r)}`}},Se={name:"print",visible:"PRINT",expression:se("PRINT {expr}"),execute(e,t){t.args.forEach((t=>{const r=e.evaluate(t);e.display.write($(r)?r:r.toString())})),e.display.nl()},render:e=>`PRINT ${e.args.map(ie).join("; ")}`},Ae={name:"print-no-nl",visible:"PRINT",expression:se("PRINT {expr} ;"),execute(e,t){t.args.forEach((t=>{const r=e.evaluate(t);e.display.write($(r)?r:r.toString())}))},render:e=>`PRINT ${e.args.map(ie).join("; ")};`},Le={name:"run",visible:"RUN",expression:se("RUN"),execute(e){e.run()},render:()=>"RUN"},$e={name:"run-line",expression:se("RUN {expr}"),execute(e,t){const[r]=t.args,n=e.evaluate(r);if(!L(n))throw new Error("RUN only uses numbers");e.run(n)},render:e=>`RUN ${ie(e.args[0])}`},Ne={name:"while",visible:"WHILE",expression:se("WHILE {expr}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("WHILE only in programs");if(!e.evaluate(t.args[0])){const t=e.scan(["while"],["wend"]);if(!t)throw new Error("WHILE without WEND");return e.line=t,void(e.statement=0)}e.stack.push({type:"while",line:e.line,statement:e.statement})},render:e=>`WHILE ${ie(e.args[0])}`},Ie={name:"wend",visible:"WEND",expression:se("WEND"),execute(e){if(e.state!==_e.Execute)throw new Error("WEND only in programs");const t=e.topclause;if(!t||"while"!==t.type)throw new Error("WEND without WHILE");e.stack.pop(),e.line=t.line,e.statement=t.statement-1},render:()=>"WEND"},Te={name:"clr",visible:"CLR",expression:se("CLR"),execute(e){e.vars.clear()},render:()=>"CLR"},Oe={name:"cls",visible:"CLS",expression:se("CLS"),execute(e){e.display.cls()},render:()=>"CLS"},Re={name:"end",visible:"END",expression:se("END"),execute(e){if(e.state!==_e.Execute)throw new Error("END only in programs");e.state=_e.Interpret,e.display.write(`END at ${e.line}`)},render:()=>"END"},Fe={name:"goto",visible:"GOTO",expression:se("GOTO {expr}"),execute(e,t){if(e.state!==_e.Execute)throw new Error("GOTO only in programs");const[r]=t.args,n=e.evaluate(r);if(!L(n))throw new Error("GOTO only uses numbers");e.line=n,e.statement=-1},render(e){const[t]=e.args;return`GOTO ${ie(t)}`}},De={name:"help",visible:"HELP",expression:se("HELP"),execute(e){e.display.writenl(`BASIC in a Browser v${e.version.value}`),e.display.writenl("Any questions? Ask lagdotcom@gmail.com"),e.display.writenl(`Commands: ${Object.values(He).filter((e=>e.visible)).map((e=>e.visible)).sort().join(" ")}`),e.display.writenl(`Functions: ${Object.keys(J).join(" ")}`),e.display.writenl(`System: ${Object.entries(e.vars.vars).sort((([e,t],[r,n])=>e.localeCompare(r))).filter((([e,t])=>t.system)).map((([e,t])=>e.toUpperCase())).join(" ")}`)},render:()=>"HELP"},Me={name:"line",visible:"LINE",expression:se("LINE {expr} , {expr} TO {expr} , {expr}"),execute(e,t){const[r,n,s,a]=t.args,i=e.evaluate(r),o=e.evaluate(n),l=e.evaluate(s),u=e.evaluate(a);if(!(L(i)&&L(o)&&L(l)&&L(u)))throw new Error("LINE only works with numbers");e.display.line(i,o,l,u)},render(e){const[t,r,n,s]=e.args;return`LINE ${ie(t)}, ${ie(r)} TO ${ie(n)}, ${ie(s)}`}},Pe={name:"list",visible:"LIST",expression:se("LIST"),execute(e){e.program.lines.forEach((t=>{e.display.writenl(le(t))})),0===e.program.lines.length&&e.display.writenl("Program is empty")},render:()=>"LIST"},Ue=Object.fromEntries([Te,Oe,ue,fe,pe,Re,we,ge,Fe,De,me,de,he,Ce,Me,Pe,Ee,be,Ae,Se,$e,Le,ce,Ne,Ie,ke].map((e=>[e.name,e])));"undefined"!=typeof window&&(window.Keywords=Ue);const He=Ue;var _e;!function(e){e[e.Interpret=0]="Interpret",e[e.Execute=1]="Execute"}(_e||(_e={}));class We{display;input;booted;buffer;increment;line;program;raf;speed;stack;state;statement;vars;version;constructor(e,t){this.display=e,this.input=t,this.vars=new S,this.increment=this.vars.add("__increment",{value:10,system:!0}),this.speed=this.vars.add("__speed",{value:2}),this.vars.constant("pi",Math.PI),this.version=this.vars.constant("__version$","0.1.6"),this.vars.add("inkey$",{value:"",system:!0,get:()=>{const e=this.input.events.shift();return e?e.key:""}}),e.attach(this),this.buffer="",this.line=0,this.program={name:"unnamed.bas",lines:[]},this.stack=[],this.state=_e.Interpret,this.statement=0,this.booted=!1,this.tick=this.tick.bind(this)}get currentLine(){const e=this.getLine(this.line);if(!e)throw new Error(`Unknown label: ${this.line}`);return e}get currentStatement(){return this.currentLine.statements[this.statement]}get topclause(){if(this.stack.length)return this.stack[this.stack.length-1]}getLine(e){return this.program.lines.find((t=>t.label===e))}start(){this.raf=requestAnimationFrame(this.tick)}tick(e){if(this.booted||(this.display.writenl(`BASIC in a Browser v${this.version.value} ready.`),this.booted=!0),this.state===_e.Interpret)this.input.events.splice(0).forEach((e=>{switch(e.type){case"key":this.buffer+=e.key,this.display.write(e.key);break;case"back":this.buffer=this.buffer.substr(0,this.buffer.length-1),this.display.bs();break;case"meta":if("Enter"===e.key){const e=this.buffer.trim();if(this.buffer="",this.display.nl(),e)try{const t=ne(e);console.log(t),null!==t.label?t.statements.length&&(this.add(t),this.buffer=`${t.label+this.increment.value} `,this.display.write(this.buffer)):this.runStatement(t)}catch(e){this.display.writenl(e.message)}}}}));else for(var t=0;t<this.speed.value;t++){if(this.input.events.find((e=>"break"===e.type))){this.display.writenl(`BREAK at ${this.line},${this.statement}`),this.input.events.splice(0,this.input.events.length),this.state=_e.Interpret;break}if(this.runCurrentStatement(),this.state!==_e.Execute)break}this.display.update(),this.raf=requestAnimationFrame(this.tick)}evaluate(e){switch(e.type){case"number":case"string":return e.value;case"variable":if(this.vars.has(e.name))return this.vars.get(e.name);throw new Error(`Undeclared variable: ${e.name}`);case"binary":return this.op(e);case"fn":const t=J[e.name.toUpperCase()];if(!t)throw new Error(`Undeclared function: ${e.name}`);return t.evaluate(this,e.args)}throw new Error(`Unknown token type: ${e}`)}op(e){const t=this.evaluate(e.args[0]),r=this.evaluate(e.args[1]);switch(e.op){case"+":return $(t)?$(r)?t+r:t+r.toString():$(r)?t.toString()+r:t+r;case"-":if($(t)||$(r))throw new Error("Cannot subtract strings");return t-r;case"*":if($(t)||$(r))throw new Error("Cannot multiply strings");return t*r;case"/":if($(t)||$(r))throw new Error("Cannot divide strings");return t/r;case"=":return A(t==r);case"!=":case"<>":return A(t!=r);case">":if($(t)||$(r))throw new Error("Cannot compare strings");return A(t>r);case">=":if($(t)||$(r))throw new Error("Cannot compare strings");return A(t>=r);case"<":if($(t)||$(r))throw new Error("Cannot compare strings");return A(t<r);case"<=":if($(t)||$(r))throw new Error("Cannot compare strings");return A(t<=r)}}add(...e){var t=!1;e.forEach((e=>{const r=this.program.lines.findIndex((t=>t.label==e.label));-1===r?e.statements.length&&(this.program.lines.push(e),t=!0):e.statements.length?this.program.lines[r]=e:this.program.lines.splice(r,1)})),t&&this.program.lines.sort(((e,t)=>e.label-t.label))}run(e){if(!this.program.lines.length)throw new Error("No lines in program");N(e)&&(e=this.program.lines[0].label),this.state=_e.Execute,this.line=e,this.statement=0}runToEnd(e){if(!this.program.lines.length)throw new Error("No lines in program");for(N(e)&&(e=this.program.lines[0].label),this.state=_e.Execute,this.line=e,this.statement=0;this.state==_e.Execute;)this.runCurrentStatement()}runCurrentStatement(){if(this.runStatement(this.currentStatement),this.statement++,this.statement>=this.currentLine.statements.length){const e=this.program.lines.indexOf(this.currentLine);if(e==this.program.lines.length-1)return void(this.state=_e.Interpret);this.line=this.program.lines[e+1].label,this.statement=0}}runStatement(e){He[e.keyword].execute(this,e)}scan(e,t,r=0){for(var{line:n,statement:s}=this;;){const a=this.getLine(n);if(!a)return;const i=a.statements[s];if(e.includes(i.keyword)?r++:t.includes(i.keyword)&&r--,r<=0)return a.label;if(++s>=a.statements.length){const e=this.program.lines.indexOf(a);if(e==this.program.lines.length-1)return;n=this.program.lines[e+1].label,s=0}}}}window.addEventListener("load",(()=>{const e=document.createElement("canvas");e.id="basiciab",document.body.appendChild(e);const t=new x(e,8,16,12,30,80),r=new k,n=new We(t,r);window.sys=n,n.start()}))})()})();
//# sourceMappingURL=main.js.map